<html lang="en">

<head>
  <title>Drug Graph visualizer</title>

  <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script src="main.js"></script>
</head>

<body>


  <div>
    <div id="mynetwork"></div>
    <br />
    <script type="text/javascript">
      var network;
      var allNodes;
      var highlightActive = false;
      var nodesDataset = new vis.DataSet(nodes); // these come from WorldCup2014.js
      var edgesDataset = new vis.DataSet(edges); // these come from WorldCup2014.js
      // get a JSON object
      allNodes = nodesDataset.get({ returnType: "Object" });
      allEdges = edgesDataset.get({ returnType: "Object" });

      var container = document.getElementById("mynetwork");

      function redrawAll() {
        const options = {
          manipulation: false,
          height: "90%",
          layout: {
            hierarchical: {
              enabled: true,
              levelSeparation: 300,
            },
          },
          physics: {
            hierarchicalRepulsion: {
              nodeDistance: 300,
            },
          },
        };


        // transform the object into an array
        var updateArray = [];
        for (edgeId in allEdges) {
          allEdges[edgeId].hidden=true;
          updateArray.push(allEdges[edgeId]);

        }
        edgesDataset.update(updateArray);
        // transform the object into an array
        var updateArray = [];
        for (nodeId in allNodes) {
          if (allNodes[nodeId].productType!="Substance"){
            allNodes[nodeId].hidden=true
          }
          updateArray.push(allNodes[nodeId]);

        }
        nodesDataset.update(updateArray);

        var data = { nodes: nodesDataset, edges: edgesDataset }; // Note: data is coming from ./datasources/WorldCup2014.js

        network = new vis.Network(container, data, options);

        network.on("click", neighbourhoodHighlight);
      }

      function get_neibours(degrees, selectedNode) {


        // hid all nodes
        for (var nodeId in allNodes) {

          allNodes[nodeId].hidden = true;

        }
        // mark all edges as hidden
        for (var edgeId in allEdges) {

          allEdges[edgeId].hidden = true;

        }
        allNodes[selectedNode].hidden = false;

        var connectedNodes = network.getConnectedNodes(selectedNode);
        var connectedEdges = network.getConnectedEdges(selectedNode);
        var allConnectedNodes = connectedNodes;
        var allConnectedEdges = connectedEdges;
        /* var allConnectedNodes = [];
        var allConnectedEdges = [];
        
        // get the second degree nodes
        for (i = 1; i < degrees; i++) {
          for (j = 0; j < connectedNodes.length; j++) {
            allConnectedNodes = allConnectedNodes.concat(
              network.getConnectedNodes(connectedNodes[j])
            );
            console.log(network.getConnectedEdges(connectedNodes[j]))
            allConnectedEdges = allConnectedEdges.concat(
              network.getConnectedEdges(connectedNodes[j])
            );
          }
        }
        console.log(allConnectedNodes)
        console.log(allConnectedEdges)
        */
        // remove hidden from showing nodes
        for (i = 0; i < allConnectedNodes.length; i++) {

          allNodes[allConnectedNodes[i]].hidden = false;


        }
        // remove hidden from showing edges
        for (i = 0; i < allConnectedEdges.length; i++) {
          allEdges[allConnectedEdges[i]].hidden = false;


        }
        return [allConnectedNodes, allConnectedEdges]
      }

      function neighbourhoodHighlight(params) {
        // if something is selected:
        if (params.nodes.length > 0) {
          highlightActive = true;
          var i, j;
          var selectedNode = params.nodes[0];
          var result = get_neibours(2, selectedNode)
          allConnectedNodes = result[0]
          allConnectedEdges = result[1]

        } else if (highlightActive === true) {
          // reset all nodes
          for (var nodeId in allNodes) {
            allNodes[nodeId].hidden = false;

          }
          for (var edgeId in allEdges) {
            allEdges[edgeId].hidden = false;

          }
          highlightActive = false;
        } 


        // transform the object into an array
        var updateArray = [];
        for (nodeId in allNodes) {
          updateArray.push(allNodes[nodeId]);

        }
        nodesDataset.update(updateArray);

        // transform the object into an array
        var updateArray = [];
        for (edgeId in allEdges) {
          updateArray.push(allEdges[edgeId]);

        }
        edgesDataset.update(updateArray);

      }
      redrawAll();
    </script>
</body>

</html>